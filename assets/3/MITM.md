<!--
title: 基于SDN的工业物联网的中间人攻击
subtitle: 工业安全
author: 周琨
keyword: 工业安全
published: 2024-04-29
topicImg: assets/3/ASD4.png
-->

# 基于SDN的工业物联网的中间人攻击
##一、背景
目前，新一代的信息与通信技术正在促进产业新一轮的变革，例如，移动互联网和物联网等信息技术对工业生产制造领域的影响逐渐扩大。智能制造是由信息与通信技术和工业制造紧密结合而来的，而工业互联网作为智能制造中的重要基础支撑，对实现智能制造有着重大意义。对于我国而言，加快工业互联网的发展，利用数据智能和网络互连促进工业领域的转型升级，实现大规模和深层次的融合型新业态，是当前大多数行业企业的共同需求。

工业互联网发展过程中面临着许多挑战，主要包括以下几个方面：（1）云网融合过程中出现扩展性差、网络封闭和业务类型单一等问题；（2）数据中心网络出现传输时延波动、丢包严重和吞吐量耗损大等问题；（3）智能运维中存在网络流量优化、故障追踪和预测问题；（4）工业设备接入数量庞大、运转状态无法集中管理、无法获取设备分布信息和运行效率、设备故障需相关人员上报、远程调试和升级困难等问题。

工业用户对云网融合、智能运维、集中管控、低时延传输和混合云组网等方面有着迫切需求，这也决定了工业互联网向着扁平化、IP化、无线化以及灵活组网发展，其中 SDN 技术对工业互联网的发展起到了关键作用。与传统网络相比，SDN网络解耦合了控制平面与数据平面，拥有开放可编程接口，实现对网络集中管控。将SDN技术应用于工业互联网中，能有效解决上述工业互联网发展面临的挑战，且促进了企业信息化转型

在基于 SDN 的工业互联网中，中间人攻击较为常见，因为 SDN 主要对上层网络架构进行了改变，底层主机终端的通信依旧遵循 TCP/IP 协议规则，一些传统网络中的中间人攻击在基于 SDN 的工业互联网中仍然有效，且攻击的种类和方式多样化，具备强大的生命力，然而传统网络中的检测防护方法并不适用于基于 SDN 的工业互联网。攻击者通过某种方法将自己插入至网络中的通信双方之间，导致网络中通信双方的流量都会经过攻击者，一旦中间人攻击成功发生，攻击者便可实施数据监听、DNS 重定向、网页挂马和数据篡改等恶意行为，用户的隐私将遭到窃取。除此之外，攻击者还可以欺骗控制器获取到错误的网络拓扑信息，导致所有基于网络拓扑信息的上层应用都将受到影响。
##二、中间人攻击类型
中间人攻击（Man-in-the-middle attack，MITM）是一种较为常见的网络攻击，利用多种技术方法在网络中的两台终端之间实施攻击程序，攻击者与通信双方之间互相建立连接，从而窃听或者修改通信双方数据包内容。中间人攻击成功后，作为一种间接攻击模式，通信双方很难察觉到攻击者的存在，该攻击使得通信双方的机密性、数据完整性和正确性受到影响。如图所示，中间人攻击过程是“拦截信息——修改数据——发送数据”，因此也被称为“会话劫持”（Session Hijack）。

![img_14.png](assets/3/img_14.png)

由于攻击者实现中间人攻击的技术手段多样，因此中间人攻击的类型也有多种，接下来将会介绍一些常见的中间人攻击类型：
（1）基于 ARP 欺骗的中间人攻击：攻击者通过发送伪造的 ARP 数据包篡改受害者终端上的 ARP 缓存表，使得受害者终端将目标主机的 IP 地址映射到攻击者的 MAC 地址。因此，受害者终端将会把原本发给目标主机的数据包发送至攻击者，从而实现对受害者流量的拦截和篡改。
（2）基于 ICMP 欺骗的中间人攻击：ICMP（Internet Control Message Protocol）是基于 IP 协议并为其提供控制服务的协议，终端或转发设备可以利用 ICMP 发送回应消息至通信发送方。ICMP 重定向消息是路由器向主机提供实时的路由信息，当一个主机收到 ICMP 重定向消息时，会按照消息中的路由信息更新自己的路由表，由于 ICMP 重定向消息缺乏合法性检查，因此存在伪造的 ICMP 重定向消息可能，攻击者可借此使得受害者终端发送的数据被重定向至攻击者指定节点，从而实现对受害者流量的拦截和篡改，导致中间人攻击。
（3）基于 DHCP 欺骗的中间人攻击：DHCP（Dynamic Host Configuration Protocol）是一种局域网的网络协议。其功能是对局域网中的 IP 地址进行集中管理和分配，使得局域网中的主机动态的配置 IP 地址、网关地址、DNS 服务器地址等信息，并提高 IP 地址使用效率。然而，DHCP 协议存在着一些安全漏洞：无法对DHCP 消息的来源进行身份验证，且 DHCP 消息是明文传输的，DHCP 客户机与 DHCP 服务器之间的连接可能是不受信任的，无法确认对方是否合法。因此，攻击者通过伪造 DHCP 消息，让客户机认为攻击者为 DHCP 服务器，从而代替真实 DHCP 服务器给局域网中的主机动态分配攻击者指定的 IP 和网关地址，实现中间人攻击。
（4）基于 DNS 的中间人攻击：DNS（Domain Name System）是解决互联网中网上机器命名的一种系统。其主要作用是完成域名到网络地址的解析。DNS 是一种分布式数据库，利用缓存系统提高性能，但缺乏认证机制和安全防护。攻击者可以通过拦截用户和 DNS 服务器之间的通信并提供不同的目标 IP 地址，从而将用户重定向至恶意站点，实现中间人攻击。
（5）基于 SSL/TLS 欺骗的中间人攻击：基于 SSL 欺骗的中间人攻击是攻击者插入 SSL 会话中，作为客户端和服务端中间的代理，进行数据的窃听和转发，从而实现在不被客户端发觉的情况下获取或修改数据内容。如图所示，攻击者分别与服务器和客户端建立两个单独的 SSL 连接。

![img_15.png](assets/3/img_15.png)

下面以其中基于 ARP 欺骗的中间人攻击为例进行介绍。

##三、基于 SDN 的工业互联网 ARP 攻击
（1）传统网络中 ARP 协议工作原理： 
ARP（Address Resolution Protocol）是已知 IP 地址情况下获取对应 MAC 地址的一个 TCP/IP 协议。在以太网中，终端主机有一个标识网卡的物理地址即 MAC 地址，与 IP 地址呈映射关系。当局域网中的终端主机之间进行数据传输时，须获取对方 IP 地址和 MAC 地址，从而完成网络层和数据链路层的封装。

在实际通信过程中，终端设备会建立与更新 ARP 缓存表，其中包含了发生过通信的 IP 地址与 MAC 地址映射，从而提高通信效率。当主机 H1 与 H2 发生通信时，主机 H1 会在 ARP 缓存表中查询主机 H2 的 IP 地址与 MAC 地址映射。如果存在，则直接利用已知的 MAC 地址封装进数据包中相应字段；如果不存在其 ARP 表项，主机 H1 将会在局域网中发送一个广播 ARP 请求数据包，其中封装了主机 H1 自己的地址映射信息和主机 H2 的 IP 地址，局域网中的所有主机都会接收此 ARP 请求数据包，但只有主机 H2 才会对主机 H1 做出响应，并回复一个 ARP 响应数据包，其中包含了自己的 IP 地址和 MAC 地址，并根据 ARP 请求数据包中的主机 H1 的地址信息更新 ARP 缓存表。当主机 H1 收到回复的 ARP 响应数据包后，从而获取了主机 H2 的 MAC 地址，并更新自己的 ARP 缓存表。在后续的通信过程中，主机 H1 与主机 H2 便可以直接查询 ARP 缓存表来高效发送数据报文。

通过上述 ARP 协议工作机制介绍，可以发现其存在着两个主要安全漏洞：
1. ARP 数据包的交互无需建立连接：局域网中的任意主机都可以伪造 ARP 响应包对不属于自己的 ARP 请求包进行响应，欺骗受害者主机，使其在 ARP 缓存表中更新攻击者指定的恶意 IP 地址与 MAC 地址映射。
2. ARP 数据包的交互无需认证：只要 ARP 数据包符合其封装格式，局域网中的主机接收到 ARP 数据包并不会认证其发送主机身份，只会无条件根据收到的 ARP 数据包中的信息更新自己的 ARP 缓存表。 

（2）基于 SDN 的工业互联网 ARP 协议工作原理：
在基于 SDN 的工业互联网中，由于控制器的存在，ARP 数据包的交互涉及到控制器、交换机和主机，但其思想原理本质上与传统网络中类似。下面将介绍具体 ARP 数据包传输过程，如图所示：

![img_16.png](assets/3/img_16.png)

当主机 H1 首次与主机 H2 通信时，与传统网络中类似，主机 H1 先会发送一个广播 ARP 请求包来获取 H2 的 MAC 地址，ARP 请求包首先到达至交换机 S1。交换机 S1由于第一次接收，并不存在匹配其 ARP 请求包的流规则，因此交换机把此数据包封装在 Packet_in 消息中上报给控制器。控制器收到后，提取其中主机 H1 的 IP 地址、MAC 地址和位置信息（即交换机 ID 和端口号），建立或者更新主机配置信息表项。然后，控制器会下发 Packet_out 消息命令交换机 S1洪泛该 ARP 请求包。交换机 S1收到 Packet_out 消息后按照指令将该数据包洪泛至交换机 S2，交换机 S2由于同样没有相应流规则，通过 Packet_in 消息发送给控制器。控制器同样通过 Packet_out 消息命令交换机 S2洪泛此数据包，因此该 ARP 请求包被洪泛至了主机 H2。主机 H2 提取数据包中的目标 IP 地址后发现与自身对应，因此回复一个ARP 响应数据包给主机 H1。交换机 S2接收该 ARP 响应包后，由于不存在相应的流规则，同样通过 Packet_in 消息上报至控制器。控制器提取 ARP 响应包中的主机 H2 地址信息，更新主机 H2 的配置信息表项。由于已经获取到整个网络拓扑信息（根据之前 S1 和 S2 的 Packet_in 消息），控制器能够计算出具体的路由信息，从而通过 Packet_out 消息下发相应的流规则至交换机 S1和 S2。因此，交换机 S2根据流规则中的处理动作转发至交换机 S1，同理，交换机 S1也根据流规则转发该 ARP 数据包至主机 H1，从而得知了主机 H2 的 MAC 地址。

（3）基于 SDN 的工业互联网 ARP 攻击原理：
如图所示，假设攻击者控制了主机 H1，其 IP 地址和 MAC 地址分别为 IP1和 MAC1，主机 H2 的 IP 地址和 MAC 地址分别为 IP2 和 MAC2。攻击者利用主机 H1 发送伪造的 ARP 请求报文，盗用 H2 的 IP 地址，填入 ARP 请求数据包中的发送者 IP 字段，交换机 S1 收到该伪造 ARP 请求报文后，由于不存在相应的转发策略，则通过 Packet_in 消息发送至控制器，控制器提取其中的主机信息，更新出错误主机信息表项，且收到该伪造 ARP 数据包的目标主机的 ARP 缓存列表也将受到影响，从而影响主机 H2 的通信。

![img_17.png](assets/3/img_17.png)

##四、基于 SDN 的工业互联网 ARP 攻击解决方案
ARP 欺骗攻击主要利用 ARP 协议无连接和认证的漏洞，攻击者任意伪造虚假的 IP-MAC 映射关系从而发送伪造 ARP 数据包。在基于 SDN 的工业互联网中，ARP 欺骗攻击不仅影响底层设备的正常通信，同时使 SDN 控制器建立错误的拓扑信息，影响上层应用服务。可以采用基于地址位置信息绑定检测原理的方法，在控制器上设计实现具体的检测模块，当攻击者注入伪造 ARP 数据包发起攻击时，检测模块能够识别出伪造的 ARP 数据包并及时输出警告信息

注：内容来自https://kns.cnki.net/kcms2/article/abstract?v=MuKJieOJLT0EloHeCUX4elXRbIcvpr09Hs_dWGktRn3jDgQI0gXkxDs3KlvI_SClke2nCUXrKxl50y5NEn4-oocWc6qlh4vqLTPXLOS7gZ2-fhsALfmZjmmDS0nVYk8RPR4P7qVv66P-HNQsivKx-A==&uniplatform=NZKPT&language=CHS