<!--
title: 面向工业信息物理系统的安全通信机制
subtitle: 工业安全
author: 仇光强
keyword: 工业安全
published: 2024-04-25
topicImg: assets/3/ASD8.png
-->

# 面向工业信息物理系统的安全通信机制
**摘要**：工业信息物理系统(ICPS)是一个集通信、计算和控制为一体的多维度智能系统,具有资源共享、灵活性、强延展性和低维护成本等优点的同时，也具有易干扰和易攻击等缺点。这些缺点严重威胁了 ICPS 的稳定性和安全性。因此，研究面向 ICPS 的安全通信机制具有重要现实意义。
本文针对 ICPS 环境中非法接入、实时控制数据易遭篡改和高保密数据易被窃取的问题，粗略介绍了利用 FPGA 高并发特性所实现的三种安全通信机制，分别对应 ICPS 数据有线传输中的身份认证、实时控制和数据传输环节。主要内容如下：

（1）针对 ICPS 环境中攻击者非法接入的问题，所实现的一种基于国密算法的三因子身份认证系统。

（2）针对 ICPS 环境中实时控制数据易遭到篡改的问题，所实现的一种基于国密算法的防篡改快速加密系统。

（3）针对 ICPS 环境中需要传输高保密数据的需求所实现的双重动态密钥混沌加密系统。

身份认证系统可以较好的防御非法接入攻击，成为安全通信的第一道保障，防篡改快速加密系统可以抵挡住主动攻击，双动态密钥混沌加密系统可以为高保密数据提供更高安全性的加密。这三种机制的组合使用可以防御绝大多数的主动攻击和被动攻击，保证 ICPS 系统安全稳定地运行

![img_19.png](assets/3/img_19.png)

##1基于国密算法的三因子身份认证系统
身份认证技术是当前网络信息系统最重要的应用技术之一。在当今的网络应用环境中，网络资源的安全性保障通常是采用基于用户身份的资源访问控制策略。身份认证的作用是对用户的身份进行鉴别，保护网络信息系统中的数据和服务不被未授权的用户所访问，是网络安全管理的重要基础之一。

**系统模型**
身份认证模块主要负责通信端口身份认证，每个通道的认证独立进行，认证结果保存在寄存器管理模块中。本系统的身份认证为双向认证，相连接的节点 1、节点 2 同时发起
认证。互相认证均成功，节点 1 和节点 2 才能进行正常通信。

如图所示为身份认证系统模型。LINK 信号表示的是通道的链接状态。一旦检测到 RJ45 插上网线，并且网线的另一端连接着另一台通信设备，就会将 LINK 信号拉高，否则 LINK 保持低电平。同时 LINK 信号的上升沿为通道接入身份认证的启动信号。SWITCH 模块为 一个开关选择模块，通路 A 和通路 B 只有一条能连通。有以下几种情况：

（1）检测 LINK 信号为低电平，默认连接通路 A，此时协议栈无法进行通信。

（2）检测到 LINK 信号为高电平，启动通道接入身份认证。接入认证完成之后，根据认证结果来控制 SWITCH 通路，若认证成功，连接通路 B，该通道被允许进行通信；否则继续连接通路 A，该通道不允许进行通信

![img_20.png](assets/3/img_20.png)

若该通道的网线被拔出再重新插入，就会重新进行接入认证（连续进行 10 次身份认证，均全部成功才被认为接入认证成功）。若身份认证模块接收到协议栈模块发送的再认证信号，也会重新 1 次身份认证。

身份认证模块有 5 个子模块，并且工作在同一个时钟域之下，各个子模块的功能为：

DSAR 模块：该模块用于控制认证报文/响应报文的发送、信息摘要比较、认证成功次数监测、认证结果发送至寄存器管理模块。

AMGB 模块：该模块用于生成认证报文，根据自身 MAC、序列号、密钥和其他数据生成信息摘要插入认证报文中等待发送。

IDS 模块：该模块用于验证响应报文、判断认证是否成功、认证成功次数监测。

IDSR 模块：该模块用于生成认证响应报文，根据接收到的认证方 MAC、密钥和其他数据进行哈希碰撞，推导出隐藏的序列号；

信息摘要模块：该模块根据自身的 MAC、序列号、密钥、随机数来生成信息摘要供认证模块和认证响应模块使用。

##2基于国密算法的防篡改快速加密系统
在 ICPS 环境中，入侵者往往会通过向网络中广播大量的错误指令来破坏正常的操作。针对非法接入的身份认证系统这一重保护还远远不够应对日益强大的攻击。因此针对 ICPS 环境中实时控制数据易遭到篡改的问题，本文介绍了一种基于国密算法的防篡改快速加密系统。该系统能够在较短的时间完成数据加密操作并保障关键控制信息在 ICPS 环境中的安全，避免因为控制信息的误判而导致事故发生。

**系统模型**
基于国密算法（SM4、SM3）的防篡改快速加密系统主要负责数据加解密和数据帧完整性检测、防篡改等功能，通过验证数据帧末尾的信息摘要是否正确，来判断是否保存该数据帧。这样就入侵者发送的伪造报文或者出现部分缺少的报文就不会被接收节点保存下来，也就不会执行该错误操作，大大提高系统内设备通信的安全水平。如图所示为防篡改快速加密系统模型图，其中 Sources_Probes 模块提供软件复位功能，我们可以通过该模块在电脑上控制 FPGA 芯片的复位；PLL 模块负责倍频时钟，将晶振输出的的 50Mhz 时钟信号倍频成为 250Mhz 的时钟输出，作为系统的主时钟来使用；system_ctrl模块负责上电延时功能，因为 PLL 模块在上电之后需要一段时间才能将倍频时钟（250Mhz）稳定下来，因此需要设定系统上电之后延时一段时间（一般可以设置为 1~10 秒）才能开始工作；Encrypt 模块和 Decrypt 模块即为该系统的主要部分，Encrypt 模块能够将接收到的明文加密成密文并生成信息摘要再发送出去；Decrypt 模块能将接收到的密文还原成明文并验证其信息摘要是否正确；另外因为数据接收速度要远快于加密速度，为了防止出现数据丢失，本系统中还设置了多个 FIFO 用来缓存明文数据和密文数据。

![img_21.png](assets/3/mg_21.png)

防篡改快速加解密系统有 5 个子模块，并且工作在不同时钟域之下，各个子模块的功能为：

Control_Encrypt (加密控制)模块：该模块为 SM4_SM3 模块的核心模块，用于数据流控制，包括明文读取、数据分块、数据填充等。通过时序控制，保证 SM4 加密和 SM3 摘要同时进行（其中 SM4 和 SM3 均对明文进行操作），每当从 FIFO_IN 中读取出 128bit 数据，就进行一次 SM4 加密操作，每当读取出 512bit 数据，就进行一次 SM3 操作，将 SM3 最后计算出的 256bit 摘要放在报文的最后存入 FIFO_OUT。

Control_Decrypt (解密控制)模块：该模块为 SM4_SM3 模块的核心模块，用于数据流控制，包括密文读取、数据分块、数据填充等。和加密控制模块功能类似，区别是该模块从FIFO_IN 读取的密文只进行 SM4 解密操作，然后将 SM4 的解密结果保存在寄存器中，每解密出 512bit 数据，就对其进行一次 SM3 操作。全部数据解密完成后，由该模块来验证报文的完整性，通过比较 SM3 计算出的 hash 值和报文末尾 256bit 数据是否一致来判断是否保存该报文。

SM4 模块：该模块用于对报文进行对称加密，根据提供的密钥，将明文数据加密成为密文，保证了数据在传输过程中的安全。

SM3 模块：该模块用于进行信息摘要，保证了数据在传输过程中的完整性。

PLL 模块：该模块用于产生倍频时钟（50Mhz 和 250Mhz），提高系统的加解密速率。

##3双重动态密钥混沌加密系统
**系统模型**
该系统基于 TDES 加密方法和由 MD5 算法生成的动态密钥。TDES 可以将 64 位明文转换成 64 位密文，密钥长度为 192 位，具有硬件实现简单、安全性高等优点。MD5 算法可以将明文转换成不可逆的 128 位哈希值，具有低碰撞概率的优点

![img_22.png](assets/3/img_22.png)

该加密系统分为两个模块，TDES 加密模块和双动态密钥模块。

TDES加密模块由7个子模块组成。Key 子模块负责生成子密钥流，fifo_in 子模块用于存储明文，padding 子模块用于填充明文长度为 64 的倍数。为了将数据吞吐量提高到三倍，该模块采用三个 DES 子模块形成流水线工作模式来顺序加密明文。最后，fifo_out 子模块存储该模块的输出，即相应的密文。

双动态密钥模块包含3个子模块。Control 子模块负责控制密钥有效期（𝒯）和数据读取操作。MD5_KEY 子模块的作用是更新密钥，而 MD5_cycle 子模块的目的是更新密钥有效期。

注：内容来自https://kns.cnki.net/kcms2/article/abstract?v=CNKoHtoL3RGwJq6Buv0Yddc31bsgNBBtIQTQ2PRBLlzdlwZrm1IV1JRohGRNwCSUGyIHy0DwyAfqmnWJuoo1dVPeo6TkwqRotAwTzq7DQUCNVdElAWbSGtqHAuPgczG5Ee90IocpDmzrzmqjKbNU1w==&uniplatform=NZKPT&language=CHS